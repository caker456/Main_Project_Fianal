"""pip install psycopg2 or""" 

backend
python app.py

postgre v18
dbname="postgres",user="postgres",password="1234",host="localhost",port="5432"

pip install psycopg2-binary
pip install fastapi uvicorn sqlalchemy
pip install PyPDF2
pip install passlib[bcrypt]==1.7.4
pip install bcrypt==4.0.1
pip install python-mutipart
pip install itsdangerous

frontend
npm install vite --save-dev
npm install @phosphor-icons/react
npm install @mui/material @emotion/react @emotion/styled @muiicons-material

npm run dev




















db

DROP SCHEMA public CASCADE;
CREATE SCHEMA public;





-- MEMBER_ROLES insert
insert into MEMBER_ROLES values('R1', 'admin');
insert into MEMBER_ROLES values('R2', 'user');


-- MEMBER_GRADES insert
insert into MEMBER_GRADES values('G1', 'admin');
insert into MEMBER_GRADES values('G2', 'normal');
-- ============================================
-- PDF 텍스트 추출 프로젝트 - 테이블 생성 스크립트
-- Oracle Database 11g XE
-- ============================================

-- SEQUENCE 생성 (Oracle 11g에서는 IDENTITY 대신 SEQUENCE 사용)
CREATE SEQUENCE SEQ_PDF_DOCUMENTS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_OCR_RESULTS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_DOCUMENT_SUMMARIES START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_DOCUMENT_KEYWORDS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_PROCESSING_LOG START WITH 1 INCREMENT BY 1;
-- MEMBER_INFO의 SEQUENCE 생성


-- 1. MEMBER_GRADES 테이블
CREATE TABLE member_grades (
    member_grade       VARCHAR(2) PRIMARY KEY,
    member_rating_name VARCHAR(50)
);

-- 2. MEMBER_ROLES 테이블
CREATE TABLE member_roles (
    member_role       VARCHAR(3) PRIMARY KEY,
    member_role_name  VARCHAR(50)
);


-- 3. MEMBER_INFO 테이블
CREATE TABLE member_info (
    member_id      INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id             VARCHAR(50) UNIQUE NOT NULL,
    password       VARCHAR(100) NOT NULL,
    name           VARCHAR(100) NOT NULL,
    phone          VARCHAR(20) NOT NULL,
    email          VARCHAR(100) NOT NULL,
    member_role    VARCHAR(50) DEFAULT 'R2',
    member_grade   VARCHAR(50) DEFAULT 'G2',
    CONSTRAINT fk_member_role 
        FOREIGN KEY (member_role) REFERENCES member_roles(member_role),
    CONSTRAINT fk_member_grade 
        FOREIGN KEY (member_grade) REFERENCES member_grades(member_grade)
);

-- 4. MEMBER_LOG 테이블
CREATE TABLE member_log (
    member_id          INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    create_date        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_date        TIMESTAMP,
    date_of_connection TIMESTAMP,
    access_count       NUMERIC DEFAULT 0,
    CONSTRAINT fk_member_log_member 
        FOREIGN KEY (member_id) REFERENCES member_info(member_id)
);


-- 5. PDF_DOCUMENTS 테이블 (메인 테이블)
CREATE TABLE PDF_DOCUMENTS (
    DOC_ID          INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    FILENAME        VARCHAR(255)   NOT NULL,
    UPLOAD_DATE     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    FILE_SIZE       NUMERIC,
    PAGE_COUNT      NUMERIC,
    STATUS          VARCHAR(50)    DEFAULT 'UPLOADED',
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    MEMBER_ID       INTEGER,
    CONSTRAINT fk_pdf_member
        FOREIGN KEY (MEMBER_ID) REFERENCES member_info(member_id)
);

-- 6. OCR_RESULTS 테이블
CREATE TABLE OCR_RESULTS (
    OCR_ID          INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DOC_ID          INTEGER          NOT NULL,
    FULL_TEXT       TEXT,
    PAGE_DATA       TEXT,
    OCR_ENGINE      VARCHAR(50)    DEFAULT 'PaddleOCR',
    PROCESSING_TIME NUMERIC,
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_OCR_DOC FOREIGN KEY (DOC_ID) REFERENCES PDF_DOCUMENTS(DOC_ID) ON DELETE CASCADE
);

-- 7. DOCUMENT_SUMMARIES 테이블
CREATE TABLE DOCUMENT_SUMMARIES (
    SUMMARY_ID      INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DOC_ID          INTEGER          NOT NULL,
    SUMMARY_TYPE    VARCHAR(50)    DEFAULT 'medium',
    SUMMARY_FORMAT  VARCHAR(50)    DEFAULT 'paragraph',
    SUMMARY_TEXT    TEXT,
    BRIEF           VARCHAR(500),
    MAIN_POINTS     TEXT,
    DETAILED        TEXT,
    MODEL_NAME      VARCHAR(100)   DEFAULT 'gemma2-category',
    CONFIDENCE      NUMERIC(3,2),
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_SUMMARY_DOC FOREIGN KEY (DOC_ID) REFERENCES PDF_DOCUMENTS(DOC_ID) ON DELETE CASCADE
);

-- 8. DOCUMENT_KEYWORDS 테이블
CREATE TABLE DOCUMENT_KEYWORDS (
    KEYWORD_ID      INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DOC_ID          INTEGER          NOT NULL,
    KEYWORDS        TEXT,
    MAIN_TOPIC      VARCHAR(500),
    KEYWORD_COUNT   NUMERIC,
    RAW_RESPONSE    TEXT,
    MODEL_NAME      VARCHAR(100)   DEFAULT 'gemma2-category',
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_KEYWORD_DOC FOREIGN KEY (DOC_ID) REFERENCES PDF_DOCUMENTS(DOC_ID) ON DELETE CASCADE
);

-- 9. PROCESSING_LOG 테이블
CREATE TABLE PROCESSING_LOG (
    LOG_ID          INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DOC_ID          INTEGER,
    PROCESS_TYPE    VARCHAR(50)    NOT NULL,
    STATUS          VARCHAR(50)    NOT NULL,
    ERROR_MESSAGE   VARCHAR(1000),
    PROCESSING_TIME NUMERIC,
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_LOG_DOC FOREIGN KEY (DOC_ID) REFERENCES PDF_DOCUMENTS(DOC_ID) ON DELETE CASCADE
);

-- ------------------------------------------------------------

-- 6. 인덱스 생성 (성능 향상)
CREATE INDEX IDX_PDF_FILENAME ON PDF_DOCUMENTS(FILENAME);
CREATE INDEX IDX_PDF_UPLOAD_DATE ON PDF_DOCUMENTS(UPLOAD_DATE);
CREATE INDEX IDX_OCR_DOC_ID ON OCR_RESULTS(DOC_ID);
CREATE INDEX IDX_SUMMARY_DOC_ID ON DOCUMENT_SUMMARIES(DOC_ID);
CREATE INDEX IDX_KEYWORD_DOC_ID ON DOCUMENT_KEYWORDS(DOC_ID);
CREATE INDEX IDX_LOG_DOC_ID ON PROCESSING_LOG(DOC_ID);

-- 7. 자동 증가 트리거 생성 (INSERT 시 SEQUENCE 사용)
CREATE OR REPLACE TRIGGER TRG_PDF_DOCUMENTS_INSERT
BEFORE INSERT ON PDF_DOCUMENTS
FOR EACH ROW
BEGIN
    IF :NEW.DOC_ID IS NULL THEN
        SELECT SEQ_PDF_DOCUMENTS.NEXTVAL INTO :NEW.DOC_ID FROM DUAL;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER TRG_OCR_RESULTS_INSERT
BEFORE INSERT ON OCR_RESULTS
FOR EACH ROW
BEGIN
    IF :NEW.OCR_ID IS NULL THEN
        SELECT SEQ_OCR_RESULTS.NEXTVAL INTO :NEW.OCR_ID FROM DUAL;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER TRG_DOCUMENT_SUMMARIES_INSERT
BEFORE INSERT ON DOCUMENT_SUMMARIES
FOR EACH ROW
BEGIN
    IF :NEW.SUMMARY_ID IS NULL THEN
        SELECT SEQ_DOCUMENT_SUMMARIES.NEXTVAL INTO :NEW.SUMMARY_ID FROM DUAL;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER TRG_DOCUMENT_KEYWORDS_INSERT
BEFORE INSERT ON DOCUMENT_KEYWORDS
FOR EACH ROW
BEGIN
    IF :NEW.KEYWORD_ID IS NULL THEN
        SELECT SEQ_DOCUMENT_KEYWORDS.NEXTVAL INTO :NEW.KEYWORD_ID FROM DUAL;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER TRG_PROCESSING_LOG_INSERT
BEFORE INSERT ON PROCESSING_LOG
FOR EACH ROW
BEGIN
    IF :NEW.LOG_ID IS NULL THEN
        SELECT SEQ_PROCESSING_LOG.NEXTVAL INTO :NEW.LOG_ID FROM DUAL;
    END IF;
END;
/

-- 8. UPDATE 트리거 (UPDATED_AT 자동 갱신)
CREATE OR REPLACE TRIGGER TRG_PDF_DOCUMENTS_UPDATE
BEFORE UPDATE ON PDF_DOCUMENTS
FOR EACH ROW
BEGIN
    :NEW.UPDATED_AT := CURRENT_TIMESTAMP;
END;
/

-- 완료 메시지
SELECT '테이블 생성 완료!' as MESSAGE FROM DUAL;

-- 생성된 테이블 확인
SELECT table_name FROM user_tables
WHERE table_name IN ('PDF_DOCUMENTS', 'OCR_RESULTS', 'DOCUMENT_SUMMARIES', 'DOCUMENT_KEYWORDS', 'PROCESSING_LOG')
ORDER BY table_name;






